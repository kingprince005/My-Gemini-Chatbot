<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Chatbot</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" />
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Cpath fill='%234285F4' d='M18 0C8.06 0 0 8.06 0 18s8.06 18 18 18 18-8.06 18-18S27.94 0 18 0zm0 5c2.48 0 4.5 2.02 4.5 4.5S20.48 14 18 14s-4.5-2.02-4.5-4.5S15.52 5 18 5zm9 20.25c0 .97-3.03 5.75-9 5.75s-9-4.78-9-5.75v-1.5c0-3.311 4.03-6 9-6s9 2.689 9 6v1.5z'/%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
            transition: background-color 0.3s, color 0.3s, transform 0.3s, box-shadow 0.3s;
        }

        :root {
            --text-color: #E3E3E3;
            --subheading-color: #828282;
            --placeholder-color: #A6A6A6;
            --primary-color: #1E1E2E;
            --secondary-color: #2A2A3F;
            --secondary-hover-color: #3D3D5C;
            --accent-color: #4285f4;
            --accent-hover-color: #3367d6;
            --error-color: #FF5252;
            --success-color: #4CAF50;
            --border-radius: 12px;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            --message-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        body {
            background: var(--primary-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        body * {
            transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
        }

        .header, .typing-area {
            color: var(--text-color);
        }

        .header, .chat-list .message, .typing-form {
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .header {
            padding: 1.5rem;
            animation: fadeIn 1s ease-out;
        }

        /* Logo styling */
        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            animation: slideInUp 0.8s ease-out;
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            position: relative;
            animation: pulse 2s infinite;
        }

        .logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 10px rgba(66, 133, 244, 0.5));
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 600;
            color: #4285f4;
            letter-spacing: -0.5px;
            background: linear-gradient(45deg, #4285f4, #d96570);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(66, 133, 244, 0.2);
        }

        .header :where(.title, .subtitle) {
            font-weight: 500;
        }

        .header .title {
            font-size: 2.7rem;
            width: fit-content;
            background-clip: text;
            background: linear-gradient(to right, #4285f4, #d96570);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 2.4rem;
            color: var(--subheading-color);
            letter-spacing: -0.5px;
        }

        .suggestion-list {
            margin-top: 2rem;
            list-style: none;
            display: flex;
            gap: 1.25rem;
            overflow-x: auto;
            padding-bottom: 1rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .suggestion-list::-webkit-scrollbar {
            display: none;
        }

        .suggestion-list .suggestion {
            padding: 1.5rem;
            cursor: pointer;
            width: 250px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: space-between;
            border-radius: var(--border-radius);
            background: var(--secondary-color);
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            opacity: 0;
            animation: slideInUp 0.6s forwards;
        }

        .suggestion-list .suggestion:nth-child(1) { animation-delay: 0.1s; }
        .suggestion-list .suggestion:nth-child(2) { animation-delay: 0.2s; }
        .suggestion-list .suggestion:nth-child(3) { animation-delay: 0.3s; }
        .suggestion-list .suggestion:nth-child(4) { animation-delay: 0.4s; }

        .suggestion-list .suggestion:hover {
            background: var(--secondary-hover-color);
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow);
        }

        .suggestion-list .suggestion .text {
            font-weight: 400;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .suggestion-list .suggestion .icon {
            height: 42px;
            width: 42px;
            font-size: 1.3rem;
            margin-top: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.2);
            color: var(--accent-color);
        }

        .chat-list {
            padding: 2rem 1rem 7rem;
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chat-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-list::-webkit-scrollbar-track {
            background: var(--primary-color);
        }
        
        .chat-list::-webkit-scrollbar-thumb {
            background: var(--secondary-hover-color);
            border-radius: 10px;
        }

        .chat-list .message {
            margin: 1.5rem 0;
            opacity: 0;
            animation: fadeInMessage 0.5s forwards;
            width: 100%;
            max-width: 850px; /* Control max width of messages */
            display: flex;
            justify-content: center;
        }

        .chat-list .message.outgoing .message-content {
            flex-direction: row-reverse;
        }

        .chat-list .message .message-content {
            display: flex;
            gap: 1.5rem;
            width: 100%;
            align-items: flex-start;
            border-radius: var(--border-radius);
            padding: 0.5rem;
        }

        .chat-list .message.outgoing .message-content {
            background: rgba(66, 133, 244, 0.08);
            box-shadow: var(--message-shadow);
        }

        .chat-list .message.incoming .message-content {
            background: rgba(255, 255, 255, 0.03);
            box-shadow: var(--message-shadow);
        }

        .chat-list .message .avatar {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .chat-list .message .user-avatar {
            width: 42px;
            height: 42px;
            object-fit: cover;
            border: 2px solid #FF7F50;
        }

        .chat-list .message.loading .avatar {
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            100% {
                transform: rotate(360deg);
            }
        }

        .chat-list .message .text {
            color: var(--text-color);
            flex: 1;
            line-height: 1.6;
            font-size: 0.95rem;
            padding: 0.5rem;
            word-break: break-word;
        }

        .chat-list .message.loading .text {
            display: none;
        }

        .chat-list .message .icon {
            height: 35px;
            width: 35px;
            display: flex;
            cursor: pointer;
            font-size: 1.25rem;
            margin-left: 1rem;
            align-items: center;
            border-radius: 50%;
            justify-content: center;
            color: var(--text-color);
            background: var(--secondary-color);
            visibility: hidden;
            flex-shrink: 0;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .chat-list .message:not(.loading):hover .icon {
            visibility: visible;
        }

        .chat-list .message .icon:hover {
            background: var(--secondary-hover-color);
            transform: scale(1.1);
            opacity: 1;
        }

        .chat-list .loading-indicator {
            display: flex;
            width: 100%;
            gap: 0.8rem;
            flex-direction: column;
            padding: 0.5rem;
        }

        .chat-list .loading-indicator .loading-bar {
            height: 8px;
            width: 100%;
            border-radius: 4px;
            background: linear-gradient(to right, #4285f4, var(--primary-color), #4285f4);
            background-size: 200% 100%;
            animation: animate 3s linear infinite;
        }

        .chat-list .loading-indicator .loading-bar:last-child {
            width: 70%;
        }

        @keyframes animate {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        .typing-area {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 1rem;
            background: var(--primary-color);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            z-index: 10;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .typing-form {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .typing-form .input-wrapper {
            flex: 1;
            position: relative;
        }

        .typing-form .typing-input {
            width: 100%;
            color: var(--text-color);
            border: none;
            outline: none;
            background: var(--secondary-color);
            padding: 1rem 4rem 1rem 1rem;
            border-radius: var(--border-radius);
            resize: none;
            height: 56px;
            line-height: 1.5;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .typing-form .typing-input:focus {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(66, 133, 244, 0.3);
        }

        .typing-form .icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.4rem;
            cursor: pointer;
            color: var(--text-color);
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .typing-form .icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .typing-form .send-btn {
            background: var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(66, 133, 244, 0.3);
            transition: all 0.3s ease;
        }

        .typing-form .send-btn:hover {
            transform: scale(1.1);
            background: var(--accent-hover-color);
        }

        .typing-form .send-btn:active {
            transform: scale(0.95);
        }

        .action-buttons {
            display: flex;
            gap: 0.7rem;
        }

        .action-buttons .icon {
            font-size: 1.2rem;
            padding: 0.8rem;
            background: var(--secondary-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .action-buttons .icon:hover {
            background: var(--secondary-hover-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .action-buttons .icon:active {
            transform: translateY(0);
        }

        .disclaimer-text {
            text-align: center;
            margin-top: 0.5rem;
            color: white;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .footer-credit {
            text-align: center;
            margin-top: 0.5rem;
            color: white;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Light mode styles */
        body.light-mode {
            --text-color: #333333;
            --primary-color: #F5F5F7;
            --secondary-color: #FFFFFF;
            --secondary-hover-color: #F0F0F0;
            --subheading-color: #666666;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            --card-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        body.light-mode .disclaimer-text,
        body.light-mode .footer-credit {
            color: #333333;
        }

        body.light-mode .chat-list .message.outgoing .message-content {
            background: rgba(66, 133, 244, 0.05);
        }

        body.light-mode .chat-list .message.incoming .message-content {
            background: rgba(0, 0, 0, 0.02);
        }

        /* Code block styling */
        .chat-list .message .text pre {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Roboto Mono', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        body.light-mode .chat-list .message .text pre {
            background: rgba(0, 0, 0, 0.05);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .chat-list .message .text code {
            font-family: 'Roboto Mono', 'Consolas', 'Monaco', monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        body.light-mode .chat-list .message .text code {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Code highlighting */
        .chat-list .message .text pre .keyword {
            color: #cc99cd;
        }
        .chat-list .message .text pre .string {
            color: #7ec699;
        }
        .chat-list .message .text pre .comment {
            color: #999;
            font-style: italic;
        }
        .chat-list .message .text pre .function {
            color: #f8c555;
        }
        .chat-list .message .text pre .number {
            color: #f08d49;
        }

        body.light-mode .chat-list .message .text pre .keyword {
            color: #9d00ff;
        }
        body.light-mode .chat-list .message .text pre .string {
            color: #008000;
        }
        body.light-mode .chat-list .message .text pre .comment {
            color: #696969;
        }
        body.light-mode .chat-list .message .text pre .function {
            color: #ca8500;
        }
        body.light-mode .chat-list .message .text pre .number {
            color: #ca5000;
        }

        /* Error message */
        .chat-list .message .text.error {
            color: var(--error-color);
        }

        /* API key input overlay */
        .api-key-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            animation: fadeIn 0.3s ease-out;
        }

        .api-key-container {
            background: var(--primary-color);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: scaleIn 0.3s ease-out;
        }

        .api-key-container h2 {
            color: var(--text-color);
            margin-bottom: 1rem;
            font-size: 1.8rem;
            text-align: center;
        }

        .api-key-container p {
            color: var(--text-color);
            margin-bottom: 1.5rem;
            line-height: 1.6;
            opacity: 0.9;
        }

        .api-key-container input {
            width: 100%;
            padding: 1rem 1.2rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--secondary-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .api-key-container input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.2);
            outline: none;
        }

        .api-key-container button {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .api-key-container button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .api-key-container button:active {
            transform: translateY(0);
        }

        .api-key-container .save-btn {
            background: var(--accent-color);
            color: white;
        }

        .api-key-container .save-btn:hover {
            background: var(--accent-hover-color);
        }

        .api-key-container .demo-btn {
            background: #666;
            color: white;
        }

        .api-key-container .demo-btn:hover {
            background: #555;
        }

        .api-key-container .info-link {
            display: block;
            margin-top: 1.5rem;
            color: var(--accent-color);
            text-decoration: none;
            text-align: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .api-key-container .info-link:hover {
            color: var(--accent-hover-color);
            text-decoration: underline;
        }

        /* Voice input animation */
        .voice-input.active {
            animation: pulse 1.5s infinite;
            color: var(--error-color) !important;
        }
        @keyframes pulse {
            0% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.2); }
            100% { transform: translateY(-50%) scale(1); }
        }

        /* Voice status indicator */
        .voice-status {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary-color);
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            color: var(--text-color);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: slideUp 0.3s ease-out;
        }

        .voice-status .status-text {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-status .status-text::before {
            content: "";
            width: 12px;
            height: 12px;
            background: var(--error-color);
            border-radius: 50%;
            display: inline-block;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeInMessage {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        /* Export button animation */
        .export-chat:hover {
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* Message bubble typing effect */
        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .typing-dots .dot {
            width: 8px;
            height: 8px;
            background: var(--text-color);
            border-radius: 50%;
            opacity: 0.6;
        }

        .typing-dots .dot:nth-child(1) { animation: blink 1s infinite 0s; }
        .typing-dots .dot:nth-child(2) { animation: blink 1s infinite 0.2s; }
        .typing-dots .dot:nth-child(3) { animation: blink 1s infinite 0.4s; }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .header .title {
                font-size: 2rem;
            }
            
            .header .subtitle {
                font-size: 1.5rem;
            }
            
            .suggestion-list {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .suggestion-list .suggestion {
                width: calc(50% - 1rem);
                min-width: 200px;
            }
            
            .chat-list {
                padding-bottom: 8rem;
            }
            
            .action-buttons .icon {
                font-size: 1.2rem;
                padding: 0.7rem;
                width: 38px;
                height: 38px;
            }

            .typing-form .typing-input {
                height: 50px;
                font-size: 0.95rem;
            }
        }
        
        @media (max-width: 480px) {
            .header .title {
                font-size: 1.8rem;
            }
            
            .header .subtitle {
                font-size: 1.3rem;
            }
            
            .suggestion-list .suggestion {
                width: 100%;
                padding: 1.2rem;
            }
            
            .chat-list .message .text {
                font-size: 0.9rem;
            }
            
            .typing-form .typing-input {
                height: 48px;
                font-size: 0.9rem;
                padding: 1rem 3.5rem 1rem 1rem;
            }
            
            .action-buttons {
                gap: 0.4rem;
            }
            
            .action-buttons .icon {
                width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }
            
            .disclaimer-text {
                font-size: 0.7rem;
            }

            .api-key-container {
                padding: 1.5rem;
            }
            
            .api-key-container h2 {
                font-size: 1.5rem;
            }
        }

        /* Welcome message styling */
        .welcome-message {
            background: linear-gradient(135deg, rgba(66, 133, 244, 0.15), rgba(219, 68, 55, 0.05)) !important;
            border: 1px solid rgba(66, 133, 244, 0.2);
            border-radius: var(--border-radius);
            padding: 1rem;
            animation: fadeInMessage 0.8s, pulseLight 3s infinite alternate;
        }

        .welcome-tips {
            animation: fadeIn 0.5s;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .welcome-tips ul li {
            margin-bottom: 5px;
        }

        @keyframes pulseLight {
            0% { box-shadow: 0 0 5px rgba(66, 133, 244, 0.1); }
            100% { box-shadow: 0 0 15px rgba(66, 133, 244, 0.2); }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        body.light-mode ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
        }
        
        body.light-mode ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Empty state styling */
        .chat-list:empty::before {
            content: "";
            display: block;
            height: 100px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' width='100' height='100' opacity='0.1'%3E%3Cpath fill='%234285F4' d='M50 0C22.4 0 0 22.4 0 50s22.4 50 50 50 50-22.4 50-50S77.6 0 50 0zm0 14c7 0 12.5 5.5 12.5 12.5S57 39 50 39s-12.5-5.5-12.5-12.5S43 14 50 14zm25 56.3c0 2.7-8.3 15.7-25 15.7s-25-13-25-15.7v-4.1c0-9.2 11.2-16.6 25-16.6s25 7.4 25 16.6v4.1z'%3E%3C/path%3E%3C/svg%3E");
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.07;
            margin-top: 20vh;
        }

        /* Theme toggle container */
        .theme-toggle-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        /* Theme toggle button styling */
        .theme-toggle-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, var(--accent-color), #8c43ff);
            color: white;
            cursor: pointer;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            transform: scale(1);
        }

        .theme-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .theme-toggle-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <header class="header">
        <!-- Animated Logo -->
        <div class="logo-container">
            <div class="logo">
                <img src="../image/Gemini logo.png" alt="Gemini Logo" class="logo-img">
            </div>
            <div class="logo-text">Gemini AI</div>
        </div>
        
        <!-- Heading Greetings -->
        <h2 class="title">Hello, there</h2>
        <h4 class="subtitle">How can I help you today?</h4>
   
        <!-- Suggestion List -->
        <ul class="suggestion-list">
            <li class="suggestion"> 
                <h4 class="text">Help me plan a game night with my 5 best friends for under 500rs.</h4>
                <span class="material-symbols-rounded icon">draw</span>
            </li>
            <li class="suggestion"> 
                <h4 class="text">What are the best tips to improve my public speaking skills?</h4>
                <span class="material-symbols-rounded icon">lightbulb</span>
            </li>
            <li class="suggestion">
                <h4 class="text">Can you help me find the latest news on Web development?</h4>
                <span class="material-symbols-rounded icon">explore</span> 
            </li>
            <li class="suggestion">     
                <h4 class="text">Write a JavaScript code to sum all elements in an array.</h4>
                <span class="material-symbols-rounded icon">code</span>
            </li>
        </ul>
    </header>
    
    <!-- Theme Toggle Button (Fixed at top right) -->
    <div class="theme-toggle-container">
        <button class="theme-toggle-btn" title="Toggle Theme">
            <span class="material-symbols-rounded">light_mode</span>
        </button>
    </div>

    <!-- Chat List / Container -->
    <div class="chat-list"></div>

    <!-- Typing Area -->
    <div class="typing-area">
        <form action="#" class="typing-form">
            <div class="input-wrapper">
                <textarea placeholder="Ask me anything..." class="typing-input" required></textarea>
                <button type="submit" class="icon send-btn material-symbols-rounded">send</button>
                <span class="icon voice-input material-symbols-rounded" style="right: 60px; cursor: pointer;">mic</span>
            </div>
            <div class="action-buttons">
                <span class="icon material-symbols-rounded" title="Toggle Theme">light_mode</span>
                <span class="icon material-symbols-rounded" title="Clear Chat">delete</span>
                <span class="icon material-symbols-rounded" id="api-key-btn" title="Set API Key">key</span>
                <span class="icon material-symbols-rounded export-chat" title="Export Chat">file_download</span>
            </div>
        </form>
        <p class="disclaimer-text">
            Gemini may display inaccurate info, including about people, so double-check its responses.
        </p>
        <p class="footer-credit">
            Made with ❤️ by Prince
        </p>
    </div>

    <!-- Voice Input Status -->
    <div class="voice-status" style="display: none;">
        <span class="status-text">Listening...</span>
    </div>

    <!-- API Key Overlay -->
    <div class="api-key-overlay" id="api-key-overlay">
        <div class="api-key-container">
            <h2>Enter your Gemini API Key</h2>
            <p>You need a Gemini API key to use this chatbot. Get one for free from Google AI Studio:</p>
            <input type="text" id="api-key-input" placeholder="Your Gemini API Key">
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button id="save-api-key" class="save-btn">Save API Key</button>
                <button id="demo-mode" class="demo-btn">Try Demo Mode</button>
            </div>
            <div id="api-key-message" style="margin-top: 10px; text-align: center;"></div>
            <a href="https://makersuite.google.com/app/apikey" class="info-link" target="_blank">Get a free API key</a>
        </div>
    </div>

    <script>
        // Global variables - these will be initialized/updated by fix.js
        window.API_KEY = "";
        window.IS_DEMO_MODE = false;
        
        document.addEventListener("DOMContentLoaded", () => {
            console.log("DOMContentLoaded event fired");
            
            // Initialize variables
            // Get DOM elements using more reliable selectors
            const chatList = document.querySelector(".chat-list");
            const typingForm = document.querySelector(".typing-form");
            const inputField = document.querySelector(".typing-input");
            const sendButton = document.querySelector(".typing-form .icon");
            const suggestionList = document.querySelector(".suggestion-list");
            const header = document.querySelector(".header");
            const voiceInputBtn = document.querySelector(".voice-input");
            const voiceStatus = document.querySelector(".voice-status");
            const statusText = document.querySelector(".status-text");
            const exportChatBtn = document.querySelector(".export-chat");
            
            // Controls
            const clearChatBtn = document.querySelector(".action-buttons .icon:nth-child(2)");
            const themeToggleBtn = document.querySelector(".action-buttons .icon:nth-child(1)");
            
            // API key overlay elements - these are managed by fix.js
            const apiKeyOverlay = document.getElementById("api-key-overlay");
            const apiKeyInput = document.getElementById("api-key-input");
            
            // Check for saved API key or demo mode
            const savedApiKey = localStorage.getItem("gemini_api_key");
            const demoMode = localStorage.getItem("gemini_demo_mode") === "true";
            
            // Debug the current state
            console.log("Current API Key exists:", !!window.API_KEY);
            console.log("Current Demo Mode:", window.IS_DEMO_MODE);

            // Initialize API key and demo mode from localStorage
            if (savedApiKey) {
                API_KEY = savedApiKey;
                console.log("API key loaded from storage");
                // Hide API key overlay
                apiKeyOverlay.style.display = "none";
            } else if (demoMode) {
                IS_DEMO_MODE = true;
                console.log("Demo mode activated");
                // Hide API key overlay
                apiKeyOverlay.style.display = "none";
            } else {
                // Show API key overlay if no API key and not in demo mode
                apiKeyOverlay.style.display = "flex";
                console.log("Showing API key overlay - no key or demo mode");
            }

            // Save API Key Function
            function saveApiKey() {
                console.log("saveApiKey called");
                
                const key = apiKeyInput.value.trim();
                if (!key) {
                    alert("Please enter a valid API key");
                    return;
                }
                
                try {
                    // Save to localStorage
                    localStorage.setItem("gemini_api_key", key);
                    
                    // Clear demo mode if it was set
                    localStorage.removeItem("gemini_demo_mode");
                    
                    // Update globals
                    API_KEY = key;
                    IS_DEMO_MODE = false;
                    
                    // Hide overlay
                    apiKeyOverlay.style.display = "none";
                    
                    alert("API key saved successfully!");
                    
                    // Reload the page to apply changes
                    window.location.reload();
                } catch (error) {
                    console.error("Error saving API key:", error);
                    alert("Error saving API key: " + error.message);
                }
            }

            // Enable Demo Mode Function
            function enableDemoMode() {
                console.log("enableDemoMode called");
                
                try {
                    // Clear any API key and set demo mode
                    localStorage.removeItem("gemini_api_key");
                    localStorage.setItem("gemini_demo_mode", "true");
                    
                    // Update globals
                    API_KEY = "";
                    IS_DEMO_MODE = true;
                    
                    // Hide overlay
                    apiKeyOverlay.style.display = "none";
                    
                    alert("Demo mode activated!");
                    
                    // Reload the page to apply changes
                    window.location.reload();
                } catch (error) {
                    console.error("Error enabling demo mode:", error);
                    alert("Error enabling demo mode: " + error.message);
                }
            }

            let isListening = false;
            let recognition = null;
            let chatHistory = loadChatHistory();

            // Initialize SpeechRecognition if available
            function initSpeechRecognition() {
                const voiceInputBtn = document.querySelector(".voice-input");
                
                if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = true;
                    recognition.lang = 'en-US';

                    recognition.onstart = () => {
                        isListening = true;
                        voiceInputBtn.classList.add("active");
                        voiceStatus.style.display = "block";
                        statusText.textContent = "Listening...";
                    };

                    recognition.onresult = (event) => {
                        const transcript = Array.from(event.results)
                            .map(result => result[0])
                            .map(result => result.transcript)
                            .join('');
                        
                        inputField.value = transcript;
                        statusText.textContent = "Processing: " + transcript;
                    };

                    recognition.onend = () => {
                        isListening = false;
                        voiceInputBtn.classList.remove("active");
                        voiceStatus.style.display = "none";
                        
                        // If input has content, submit after a short delay
                        if (inputField.value.trim()) {
                            setTimeout(() => {
                                handleOutgoingChat();
                            }, 500);
                        }
                    };

                    recognition.onerror = (event) => {
                        console.error('Speech recognition error', event.error);
                        isListening = false;
                        voiceInputBtn.classList.remove("active");
                        voiceStatus.style.display = "none";
                    };

                    // Add click event for voice input
                    voiceInputBtn.addEventListener('click', toggleSpeechRecognition);
                } else {
                    // Hide the voice input button if not supported
                    voiceInputBtn.style.display = 'none';
                }
            }

            // Toggle speech recognition
            function toggleSpeechRecognition() {
                if (isListening) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            }

            // Load chat history from localStorage
            function loadChatHistory() {
                const savedHistory = localStorage.getItem("chatHistory");
                return savedHistory ? JSON.parse(savedHistory) : [];
            }

            // Save chat history to localStorage
            function saveChatHistory() {
                const messages = [];
                document.querySelectorAll(".chat-list .message").forEach(message => {
                    if (message.classList.contains("loading")) return;
                    
                    const text = message.querySelector(".text").textContent;
                    const isUser = message.classList.contains("outgoing");
                    
                    messages.push({
                        role: isUser ? "user" : "assistant",
                        content: text
                    });
                });
                
                localStorage.setItem("chatHistory", JSON.stringify(messages));
            }

            // Function to restore chat history
            function restoreChatHistory() {
                chatList.innerHTML = "";
                const savedHistory = localStorage.getItem("chatHistory");
                
                if (savedHistory) {
                    try {
                        const parsedHistory = JSON.parse(savedHistory);
                        
                        parsedHistory.forEach(item => {
                            if (item.role === "user") {
                                // User message
                                const html = `<div class="message-content">
                                    <img src="../image/user.jpeg" alt="User" class="avatar user-avatar">
                                    <p class="text">${item.content}</p>
                                </div>`;
                                const outgoingDiv = createMessageElement(html, "outgoing");
                                chatList.appendChild(outgoingDiv);
                            } else {
                                // Bot message
                                const html = `<div class="message-content">
                                    <img src="../image/Gemini logo.png" alt="Gemini Image" class="avatar">
                                    <p class="text">${item.content}</p>
                                    <span class="icon material-symbols-rounded">content_copy</span>
                                </div>`;
                                const incomingDiv = createMessageElement(html, "incoming");
                                chatList.appendChild(incomingDiv);
                                
                                // Add copy functionality
                                const copyBtn = incomingDiv.querySelector(".icon");
                                const textElement = incomingDiv.querySelector(".text");
                                
                                copyBtn.addEventListener("click", () => {
                                    navigator.clipboard.writeText(item.content);
                                    
                                    // Show copied indication
                                    copyBtn.textContent = "done";
                                    setTimeout(() => copyBtn.textContent = "content_copy", 1500);
                                });
                                
                                // Apply syntax highlighting to bot messages
                                applySyntaxHighlighting(textElement);
                            }
                        });
                        
                        chatList.scrollTop = chatList.scrollHeight;
                    } catch (e) {
                        console.error("Error restoring chat history:", e);
                    }
                }
            }

            // Apply code syntax highlighting
            function applySyntaxHighlighting(element) {
                const codeBlocks = element.querySelectorAll('pre');
                
                codeBlocks.forEach(block => {
                    let content = block.innerHTML;
                    
                    // Simple syntax highlighting for common languages
                    // Keywords
                    content = content.replace(/\b(function|return|if|else|for|while|var|let|const|class|import|export|from|try|catch|finally|switch|case|break|continue|default|async|await|new|this|typeof|instanceof)\b/g, '<span class="keyword">$1</span>');
                    
                    // Strings
                    content = content.replace(/(['"`])(.*?)(['"`])/g, '<span class="string">$1$2$3</span>');
                    
                    // Comments
                    content = content.replace(/\/\/(.*)/g, '<span class="comment">//$1</span>');
                    content = content.replace(/\/\*([\s\S]*?)\*\//g, '<span class="comment">/*$1*/</span>');
                    
                    // Functions
                    content = content.replace(/(\w+)(\s*\()/g, '<span class="function">$1</span>$2');
                    
                    // Numbers
                    content = content.replace(/\b(\d+)\b/g, '<span class="number">$1</span>');
                    
                    block.innerHTML = content;
                });
            }

            // Handle outgoing chat
            const handleOutgoingChat = () => {
                const userMessage = inputField.value.trim();
                if (!userMessage) return;
                
                console.log("Processing user message:", userMessage);

                // Hide header when conversation starts
                header.style.display = "none";

                // Create and display user message
                const html = `<div class="message-content">
                    <img src="../image/user.jpeg" alt="User Image" class="avatar user-avatar">
                    <p class="text">${userMessage.replace(/\n/g, '<br>')}</p>
                </div>`;

                const outgoingMessageDiv = createMessageElement(html, "outgoing");
                chatList.appendChild(outgoingMessageDiv);
                chatList.scrollTop = chatList.scrollHeight;

                // Clear input field
                inputField.value = ""; 
                
                // Save chat history with user message
                saveChatHistory();
                
                // Show loading animation and generate response
                showLoadingAnimation(userMessage);
            };

            // Show loading animation
            const showLoadingAnimation = (message) => {
                // Create animated typing dots
                const html = `<div class="message-content">
                    <img src="../image/Gemini logo.png" alt="Gemini Image" class="avatar">
                    <div class="loading-indicator">
                        <div class="typing-dots">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <div class="loading-bar"></div>
                        <div class="loading-bar"></div>
                    </div>
                </div>`;

                const loadingDiv = createMessageElement(html, "incoming", "loading");
                chatList.appendChild(loadingDiv);
                chatList.scrollTop = chatList.scrollHeight;

                // Show thinking message after delay
                setTimeout(() => {
                    if (document.querySelector(".loading")) {
                        const thinkingText = document.createElement("p");
                        thinkingText.className = "thinking-text";
                        thinkingText.textContent = "Thinking...";
                        thinkingText.style.color = "var(--text-color)";
                        thinkingText.style.opacity = "0.7";
                        thinkingText.style.fontSize = "0.9rem";
                        thinkingText.style.marginTop = "5px";
                        thinkingText.style.textAlign = "center";
                        thinkingText.style.fontStyle = "italic";
                        
                        const loadingIndicator = document.querySelector(".loading .loading-indicator");
                        if (loadingIndicator) {
                            loadingIndicator.appendChild(thinkingText);
                        }
                    }
                }, 1500);

                // Small delay before calling API for better UX
                setTimeout(() => generateAPIResponse(message), 800);
            };

            // Fetch response from Gemini API
            const generateAPIResponse = async (message) => {
                try {
                    console.log("Generating response for:", message);
                    console.log("API Key available:", !!API_KEY);
                    console.log("Demo mode:", IS_DEMO_MODE);
                    
                    if (!API_KEY && !IS_DEMO_MODE) {
                        console.log("No API key and not in demo mode, showing overlay");
                        
                        // Remove loading indicator
                        const loadingElem = document.querySelector(".loading");
                        if (loadingElem) loadingElem.remove();
                        
                        // Show the API key overlay
                        apiKeyOverlay.style.display = "flex";
                        return;
                    }

                    // If in demo mode, generate mock responses
                    if (IS_DEMO_MODE) {
                        console.log("Using demo mode response");
                        
                        // Remove loading indicator
                        const loadingElem = document.querySelector(".loading");
                        if (loadingElem) loadingElem.remove();
                        
                        // Create a demo response based on the prompt
                        let demoResponse = "I'm running in demo mode without an API key. ";
                        
                        if (message.toLowerCase().includes("hello") || message.toLowerCase().includes("hi")) {
                            demoResponse += "Hello! How can I help you today?";
                        } else if (message.toLowerCase().includes("javascript")) {
                            demoResponse += "JavaScript is a programming language commonly used for web development. Here's a simple example:\n\n```javascript\nfunction greet(name) {\n  return `Hello, ${name}!`;\n}\n\nconsole.log(greet('World'));\n```";
                        } else if (message.toLowerCase().includes("game night")) {
                            demoResponse += "Here are some budget-friendly game night ideas:\n\n1. Card games like UNO, playing cards\n2. Board games you already own\n3. Snacks: chips, popcorn, homemade treats\n4. Drinks: soft drinks or make your own punch\n5. Music playlist for atmosphere";
                        } else {
                            demoResponse += "This is a simulated response in demo mode. To get real AI responses, please add your Gemini API key.";
                        }
                        
                        // Display demo response
                        displayBotResponse(demoResponse);
                        return;
                    }

                    // Using real API with the provided key
                    console.log("Using real API with key:", API_KEY.substring(0, 4) + "****");
                    
                    // Define the models to try in order of preference
                    const models = [
                        "gemini-1.5-pro",
                        "gemini-pro",
                        "gemini-1.0-pro"
                    ];
                    
                    // API versions to try
                    const apiVersions = ["v1beta", "v1"];
                    
                    let response = null;
                    let errorMessage = "";
                    let success = false;
                    
                    // Try different models and API versions
                    for (const apiVersion of apiVersions) {
                        for (const model of models) {
                            if (success) break;
                            
                            try {
                                console.log(`Trying model: ${model} with API version: ${apiVersion}`);
                                
                                const API_URL = `https://generativelanguage.googleapis.com/${apiVersion}/models/${model}:generateContent?key=${API_KEY}`;
                                
                                response = await fetch(API_URL, {
                                    method: "POST",
                                    headers: { 
                                        "Content-Type": "application/json"
                                    },
                                    body: JSON.stringify({
                                        contents: [{ parts: [{ text: message }] }],
                                        generationConfig: {
                                            temperature: 0.7,
                                            topK: 40,
                                            topP: 0.95,
                                            maxOutputTokens: 1000
                                        }
                                    })
                                });
                        
                                if (response.ok) {
                                    success = true;
                                    console.log(`Success with model: ${model} and API version: ${apiVersion}`);
                                    break;
                                } else {
                                    const errorData = await response.json();
                                    errorMessage = errorData.error?.message || `Failed with model: ${model}`;
                                    console.error(`Failed with model: ${model} - ${errorMessage}`);
                                }
                            } catch (error) {
                                console.error(`Error with model ${model}:`, error);
                            }
                        }
                        
                        if (success) break;
                    }
                    
                    // Remove loading indicator
                    const loadingElem = document.querySelector(".loading");
                    if (loadingElem) loadingElem.remove();

                    if (!success) {
                        // Show error message
                        const errorResponseText = `API Error: ${errorMessage || "Failed to connect to Gemini API. Please check your API key."}`;
                        displayBotError(errorResponseText);
                        
                        // Check if it's an invalid API key error and prompt for a new one
                        if (errorMessage && (errorMessage.includes("API key") || errorMessage.includes("auth") || errorMessage.includes("key"))) {
                            console.log("Invalid API key detected, prompting for new key");
                            setTimeout(() => {
                                alert("Your API key appears to be invalid. Please enter a new one.");
                                // Clear localStorage
                                localStorage.removeItem("gemini_api_key");
                                API_KEY = "";
                                apiKeyInput.value = "";
                                apiKeyOverlay.style.display = "flex";
                            }, 1000);
                        }
                        
                        return;
                    }

                    // Process successful response
                    const data = await response.json();
                    
                    // Extract Gemini's response
                    const geminiReply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No response";
                    
                    // Display the bot's response
                    displayBotResponse(geminiReply);
                } catch (error) {
                    console.error("API Error:", error);
                    
                    // Remove loading and show error message
                    const loadingElem = document.querySelector(".loading");
                    if (loadingElem) loadingElem.remove();
                    
                    displayBotError("Sorry, I'm having trouble connecting. Please check your API key and internet connection.");
                }
            };
            
            // Helper to display bot responses with typing animation
            function displayBotResponse(text) {
                // Remove any existing loading message
                const loadingElem = document.querySelector(".loading");
                if (loadingElem) loadingElem.remove();
                
                // Create the message container
                const html = `<div class="message-content">
                    <img src="../image/Gemini logo.png" alt="Gemini Image" class="avatar">
                    <p class="text"></p>
                    <span class="icon material-symbols-rounded">content_copy</span>
                </div>`;

                const incomingMessageDiv = createMessageElement(html, "incoming");
                chatList.appendChild(incomingMessageDiv);
                chatList.scrollTop = chatList.scrollHeight;
                
                // Get the text element to type into
                const textElement = incomingMessageDiv.querySelector(".text");
                
                // Type each character with a small delay
                let i = 0;
                const typingSpeed = 5; // lower = faster
                const minDelay = 15; // minimum delay between characters in ms
                const maxDelay = 30; // maximum delay between characters in ms
                
                // Check if text contains code blocks, if so, we'll type it faster
                const containsCodeBlock = text.includes("```");
                const speedFactor = containsCodeBlock ? 0.5 : 1;
                
                function typeNextCharacter() {
                    if (i < text.length) {
                        // Handle HTML tags properly by looking ahead
                        if (text.charAt(i) === '<') {
                            // Find the end of this tag
                            const tagEnd = text.indexOf('>', i);
                            if (tagEnd !== -1) {
                                textElement.innerHTML += text.substring(i, tagEnd + 1);
                                i = tagEnd + 1;
                                setTimeout(typeNextCharacter, minDelay); // Process tags quickly
                                return;
                            }
                        }
                        
                        textElement.innerHTML += text.charAt(i);
                        i++;
                        
                        // Scroll to keep up with the typing
                        chatList.scrollTop = chatList.scrollHeight;
                        
                        // Randomize typing speed slightly for a more natural effect
                        // Type faster in code blocks
                        const delay = Math.floor(Math.random() * (maxDelay - minDelay) + minDelay) * speedFactor;
                        setTimeout(typeNextCharacter, delay);
                    } else {
                        // Done typing, now apply syntax highlighting
                        applySyntaxHighlighting(textElement);
                        
                        // Save chat history
                        saveChatHistory();
                    }
                }
                
                // For very long responses (like code), type faster
                if (text.length > 500) {
                    // Still show the typing effect but faster
                    text = text.replace(/\n/g, '<br>');
                    textElement.innerHTML = text;
                    applySyntaxHighlighting(textElement);
                    saveChatHistory();
                } else {
                    // Start the typing animation for shorter responses
                    setTimeout(typeNextCharacter, 200);
                }

                // Add copy functionality
                const copyBtn = incomingMessageDiv.querySelector(".icon");
                copyBtn.addEventListener("click", () => {
                    navigator.clipboard.writeText(text);
                    
                    // Show copied indication
                    copyBtn.textContent = "done";
                    setTimeout(() => copyBtn.textContent = "content_copy", 1500);
                });
            }
            
            // Helper to display error messages
            function displayBotError(errorText) {
                const errorHtml = `<div class="message-content">
                    <img src="../image/Gemini logo.png" alt="Gemini Image" class="avatar">
                    <p class="text error">${errorText}</p>
                    <span class="icon material-symbols-rounded">content_copy</span>
                </div>`;
                
                const errorDiv = createMessageElement(errorHtml, "incoming");
                chatList.appendChild(errorDiv);
                chatList.scrollTop = chatList.scrollHeight;
                
                // Add copy functionality
                const copyBtn = errorDiv.querySelector(".icon");
                copyBtn.addEventListener("click", () => {
                    navigator.clipboard.writeText(errorText);
                    
                    // Show copied indication
                    copyBtn.textContent = "done";
                    setTimeout(() => copyBtn.textContent = "content_copy", 1500);
                });
                
                // Save chat history
                saveChatHistory();
            }

            // Event listeners
            typingForm.addEventListener("submit", (e) => {
                e.preventDefault();
                handleOutgoingChat();
            });

            // Handle Enter key for sending messages
            inputField.addEventListener("keydown", (e) => {
                // Enter sends the message, Shift+Enter creates a new line
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault();
                    handleOutgoingChat();
                }
            });

            // Process suggestion click
            suggestionList.querySelectorAll(".suggestion").forEach(suggestion => {
                suggestion.addEventListener("click", () => {
                    const text = suggestion.querySelector(".text").textContent;
                    inputField.value = text;
                    handleOutgoingChat();
                });
            });

            // Theme toggle
            const topThemeToggleBtn = document.querySelector(".theme-toggle-btn");
            topThemeToggleBtn.addEventListener("click", toggleTheme);
            
            // Clear chat
            clearChatBtn.addEventListener("click", clearAllChats);
            
            // API key button - for opening the API key overlay
            apiKeyBtn.addEventListener("click", () => {
                console.log("API key button clicked");
                // Populate with current key if available
                if (API_KEY) {
                    apiKeyInput.value = API_KEY;
                } else {
                    apiKeyInput.value = "";
                }
                apiKeyOverlay.style.display = "flex";
            });
            
            // API key buttons
            const saveApiKeyBtn = document.getElementById("save-api-key");
            const demoModeBtn = document.getElementById("demo-mode");
            
            // Save API key button
            saveApiKeyBtn.addEventListener("click", (e) => {
                e.preventDefault();
                saveApiKey();
            });
            
            // Demo mode button
            demoModeBtn.addEventListener("click", (e) => {
                e.preventDefault();
                enableDemoMode();
            });
            
            // Export chat button
            exportChatBtn.addEventListener("click", () => {
                exportChat();
            });

            // Toggle theme between light and dark mode
            function toggleTheme() {
                document.body.classList.toggle("light-mode");
                const isDarkMode = !document.body.classList.contains("light-mode");
                localStorage.setItem("gemini_dark_mode", isDarkMode);
                
                // Update both theme toggle icons
                const themeIcons = document.querySelectorAll(".action-buttons .icon:nth-child(1), .theme-toggle-btn span");
                themeIcons.forEach(icon => {
                    icon.textContent = isDarkMode ? "dark_mode" : "light_mode";
                });
            }
            
            // Check and apply saved theme preference
            function applySavedTheme() {
                const darkModePreference = localStorage.getItem("gemini_dark_mode");
                
                if (darkModePreference === "false") {
                    document.body.classList.add("light-mode");
                    const themeIcons = document.querySelectorAll(".action-buttons .icon:nth-child(1), .theme-toggle-btn span");
                    themeIcons.forEach(icon => {
                        icon.textContent = "dark_mode";
                    });
                }
            }
            
            // Call to apply theme
            applySavedTheme();
            
            // Clear all chats
            function clearAllChats() {
                if (confirm("Are you sure you want to clear all chats?")) {
                    // Clear the chat list
                    chatList.innerHTML = "";
                    
                    // Clear localStorage chat history
                    localStorage.removeItem("chatHistory");
                    
                    // Show header again
                    header.style.display = "block";
                    
                    console.log("All chats cleared");
                }
            }

            // Create a new message element
            function createMessageElement(content, ...classes) {
                const div = document.createElement("div");
                div.classList.add("message", ...classes);
                div.innerHTML = content;
                return div;
            }

            // Initialize speech recognition
            initSpeechRecognition();
            
            // Load and display any saved chat history
            loadChatHistory();
            
            // Show welcome message if this is the first time or no chat history
            function showWelcomeMessage() {
                if (chatHistory.length === 0) {
                    // Wait a moment before showing the welcome message
                    setTimeout(() => {
                        const welcomeMessage = "👋 Welcome to Gemini AI Chatbot! I'm here to help you with information, answer questions, have interesting conversations, and assist with various tasks. How can I help you today?";
                        
                        // Create a special welcome message
                        const html = `<div class="message-content welcome-message">
                            <img src="../image/Gemini logo.png" alt="Gemini Image" class="avatar">
                            <div>
                                <p class="text"></p>
                                <div class="welcome-tips" style="margin-top: 15px; display: none;">
                                    <p style="margin-bottom: 10px; font-weight: 500;">Quick tips:</p>
                                    <ul style="padding-left: 20px; margin-bottom: 10px;">
                                        <li>Ask me any question or click a suggestion above</li>
                                        <li>Use the mic icon for voice input</li>
                                        <li>Click the theme icon to toggle dark/light mode</li>
                                        <li>Export your chat history using the download icon</li>
                                    </ul>
                                    <p>I'm powered by Google's Gemini AI. Enjoy chatting!</p>
                                </div>
                            </div>
                            <span class="icon material-symbols-rounded">content_copy</span>
                        </div>`;

                        const incomingMessageDiv = createMessageElement(html, "incoming", "welcome");
                        chatList.appendChild(incomingMessageDiv);
                        
                        // Type out the welcome message
                        const textElement = incomingMessageDiv.querySelector(".text");
                        let i = 0;
                        const typingSpeed = 20;
                        
                        function typeWelcome() {
                            if (i < welcomeMessage.length) {
                                textElement.textContent += welcomeMessage.charAt(i);
                                i++;
                                chatList.scrollTop = chatList.scrollHeight;
                                setTimeout(typeWelcome, typingSpeed);
                            } else {
                                // Show tips after welcome message is typed
                                const tipsElement = incomingMessageDiv.querySelector(".welcome-tips");
                                tipsElement.style.display = "block";
                                
                                // Save to chat history
                                saveChatHistory();
                            }
                        }
                        
                        setTimeout(typeWelcome, 500);
                        
                        // Add copy functionality
                        const copyBtn = incomingMessageDiv.querySelector(".icon");
                        copyBtn.addEventListener("click", () => {
                            navigator.clipboard.writeText(welcomeMessage);
                            
                            // Show copied indication
                            copyBtn.textContent = "done";
                            setTimeout(() => copyBtn.textContent = "content_copy", 1500);
                        });
                    }, 1000);
                }
            }

            // Load and display any saved chat history
            loadChatHistory();
            
            // Show welcome message if no chat history
            showWelcomeMessage();
        });

        // Function to export chat
        function exportChat() {
            const savedHistory = localStorage.getItem("chatHistory");
            
            if (!savedHistory || JSON.parse(savedHistory).length === 0) {
                alert("No chat history to export!");
                return;
            }
            
            try {
                const parsedHistory = JSON.parse(savedHistory);
                let exportText = "# Gemini Chat Export\n\n";
                
                parsedHistory.forEach(item => {
                    if (item.role === "user") {
                        exportText += `## User:\n${item.content}\n\n`;
                    } else {
                        exportText += `## Gemini:\n${item.content}\n\n`;
                    }
                });
                
                // Create a blob and downloadable link
                const blob = new Blob([exportText], { type: "text/markdown" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                
                // Generate filename with date
                const date = new Date();
                const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                const filename = `gemini-chat-${formattedDate}.md`;
                
                a.href = url;
                a.download = filename;
                a.click();
                
                // Clean up
                URL.revokeObjectURL(url);
                
                console.log("Chat exported successfully");
            } catch (e) {
                console.error("Error exporting chat:", e);
                alert("Error exporting chat. Please try again.");
            }
        }
    </script>
</body>
</html>